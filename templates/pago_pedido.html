<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Recibo - Venta #{{ recibo.venta_id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { font-size: 12px; }
            .recibo-container { border: none !important; box-shadow: none !important; }
        }
        .recibo-container {
            max-width: 400px;
            margin: 0 auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .recibo-header {
            text-align: center;
            border-bottom: 2px dashed #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .recibo-item {
            padding: 5px 0;
            border-bottom: 1px dotted #dee2e6;
        }
        .recibo-total {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .cambio-favorable { color: #2b8a3e; }
        .cambio-desfavorable { color: #c92a2a; }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="recibo-container">
            <!-- Header del recibo -->
            <div class="recibo-header">
                <h4 class="mb-2">RESTAURANTE POS</h4>
                <p class="text-muted mb-1">Sistema de Gestión</p>
                <p class="mb-1"><small>Recibo de Venta</small></p>
                <h5 class="mb-0">#{{ recibo.venta_id }}</h5>
            </div>
            
            <!-- Información -->
            <div class="mb-3">
                <p class="mb-1"><strong>Fecha:</strong> {{ recibo.fecha }}</p>
                <p class="mb-1"><strong>Mesa:</strong> {{ recibo.mesa_numero }}</p>
                <p class="mb-1"><strong>Pedido:</strong> #{{ recibo.pedido_id }}</p>
                <p class="mb-1"><strong>Método:</strong> {{ recibo.metodo_pago }}</p>
            </div>
            
            <!-- Items -->
            <div class="mb-3">
                <h6>Productos:</h6>
                {% for item in recibo.items %}
                <div class="recibo-item">
                    <div class="d-flex justify-content-between">
                        <span>{{ item.nombre }} x{{ item.cantidad }}</span>
                        <span>${{ "%.2f"|format(item.precio * item.cantidad) }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Totales -->
            <div class="recibo-total">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span>${{ "%.2f"|format(recibo.total_pedido) }}</span>
                </div>
                {% if recibo.propina > 0 %}
                <div class="d-flex justify-content-between mb-2">
                    <span>Propina:</span>
                    <span>${{ "%.2f"|format(recibo.propina) }}</span>
                </div>
                {% endif %}
                <div class="d-flex justify-content-between mb-2">
                    <span>Total:</span>
                    <strong>${{ "%.2f"|format(recibo.total_pagado) }}</strong>
                </div>
                
                {% if recibo.metodo_pago == 'Efectivo' %}
                <div class="d-flex justify-content-between mb-2">
                    <span>Recibido:</span>
                    <span>${{ "%.2f"|format(recibo.monto_recibido) }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Cambio:</span>
                    <strong class="{% if recibo.cambio >= 0 %}cambio-favorable{% else %}cambio-desfavorable{% endif %}">
                        ${{ "%.2f"|format(recibo.cambio) }}
                    </strong>
                </div>
                {% endif %}
            </div>
            
            <!-- Observaciones -->
            {% if recibo.observaciones %}
            <div class="mb-3">
                <small class="text-muted">Observaciones: {{ recibo.observaciones }}</small>
            </div>
            {% endif %}
            
            <!-- Footer -->
            <div class="text-center mt-4 pt-3 border-top">
                <small class="text-muted">
                    Gracias por su compra<br>
                    Venta procesada por: {{ usuario.nombre }}<br>
                    {{ recibo.fecha }}
                </small>
            </div>
        </div>
        
        <!-- Botones de acción -->
        <div class="text-center mt-4 no-print">
            <button onclick="window.print()" class="btn btn-primary me-2">
                <i data-feather="printer"></i> Imprimir Recibo
            </button>
            <a href="{{ url_for('pedidos') }}" class="btn btn-success">
                <i data-feather="check-circle"></i> Volver a Pedidos
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        feather.replace();
        
        // Auto-imprimir al cargar
        window.onload = function() {
            setTimeout(() => {
                window.print();
            }, 1000);
        };
        
        // Auto-redireccionar después de 10 segundos
        setTimeout(() => {
            window.location.href = "{{ url_for('pedidos') }}";
        }, 10000);
    </script>
</body>
</html>